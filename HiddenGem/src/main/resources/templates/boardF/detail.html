<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<header th:replace="~{fragments/base :: head}"></header>
	<style>
		td,
		th {
			text-align: center;
		}
	</style>
	<script th:inline="javascript">
		function likeClick(fid) {
			let oldCount = $('#likeCount').text(); // 서버 갔다오기 전 원래 있던 좋아요 갯수를 우선 받기. 클릭이 발생했을 때(서버 갔다오고) 좋아요 숫자 다시확인. 줄었으면 좋아요 취소로 바꾸고 상승이면 좋아요 클릭으로 확인
			// console.log("oldCount=" + oldCount);
			$.ajax({
				type: 'GET',
				url: '/mid/boardf/like/' + fid,
				success: function(count) {				// count = <span id="likeCount">2</span>
					$('#likeCount').replaceWith(count);
					// console.log("count=" + count);		
					let newCount = $('#likeCount').text();
					if (oldCount > newCount) 
						$('#likeIcon').attr({'class': 'fa-regular fa-thumbs-up'}); 	// 좋아요 취소
					else
						$('#likeIcon').attr({'class': 'fa-solid fa-thumbs-up'});		// 좋아요 누름
				}
			});
		}
		function deleteBoard() {
			$('#deleteModal').modal('show');
		}
	</script>
</head>

<body>
	<div th:insert="~{fragments/base :: top}"></div>

	<div class="container" style="margin-top:80px">
		<div class="row">
			<div class="col-3">
				<aside th:replace="~{fragments/base :: aside}"></aside>
			</div>

			<div class="col-9">
				<main id="main">
					<h3><strong>게시글 상세 조회</strong>
						<span style="font-size:16px">
							<a th:href="@{/boardf/list(p=${currentBoardPage},f=${field},q=${query})}"><i
									class="fa-solid fa-table-list ms-5"></i> 목록</a>

						</span>
					</h3>
					<hr>
					<!-- 제목 및 내용-->
					<div class="row mb-3">
						<div class="col-8">
							<h5>[[${boardf.title}]] 종류: [[${boardf.foodCategory}]] </h5>
							<h6>글번호: [[${boardf.fid}]] &nbsp;&nbsp;
							</h6>

						</div>
						<div class="col-4 text-end">
							<h6>조회 [[${boardf.viewCount}]] &nbsp;&nbsp; 댓글 [[${boardf.replyCount}]]</h6>
							<h6>
								<span th:if="${session.sessUid eq boardf.uid}"> <!-- 본인은 좋아요 누르지 못함 -->
									<a href="#">
										<span th:if="${session.likeClicked == 1}"><i id="likeIcon" class="fa-solid fa-thumbs-up"></i></span>
										<span th:if="${session.likeClicked == 0}"><i id="likeIcon"
												class="fa-regular fa-thumbs-up"></i></span>
										[[${count}]]
									</a>
								</span>
								<span th:if="${session.sessUid ne boardf.uid}">
									<a href="#" th:onclick="likeClick([[${boardf.fid}]])">
										<span th:if="${session.likeClicked == 1}"><i id="likeIcon" class="fa-solid fa-thumbs-up"></i></span>
										<span th:if="${session.likeClicked == 0}"><i id="likeIcon"
												class="fa-regular fa-thumbs-up"></i></span>
										<span id="likeCount" th:text="${count}"></span>
									</a>
								</span>
							</h6>
						</div>
						<hr>

						전화번호
						<div class="col-12" th:utext="${boardf.tel}"></div>
						운영시간
						<div class="col-12" th:utext="${boardf.opening}"></div>
						위치
						<div class="col-12" th:utext="${boardf.location}"></div>
						소개
						<div class="col-12" th:utext="${boardf.info}"></div>
						<br><br>
						<div id="map" style="width:350p;height:350px;"></div>

	<script type="text/javascript"
		src="//dapi.kakao.com/v2/maps/sdk.js?appkey=05fbb2c67a570b92846ce829a41ff26e&libraries=services"></script>
	<script>
		var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
			mapOption = {
				center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
				level: 3 // 지도의 확대 레벨
			};

		// 지도를 생성합니다    
		var map = new kakao.maps.Map(mapContainer, mapOption);

		// 주소-좌표 변환 객체를 생성합니다
		var geocoder = new kakao.maps.services.Geocoder();

		var address = "[[${address}]]";
		var title = "[[${title}]]";

		// 주소로 좌표를 검색합니다
		geocoder.addressSearch(address, function (result, status) {

			// 정상적으로 검색이 완료됐으면 
			if (status === kakao.maps.services.Status.OK) {

				var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

				// 결과값으로 받은 위치를 마커로 표시합니다
				var marker = new kakao.maps.Marker({
					map: map,
					position: coords
				});

				// 인포윈도우로 장소에 대한 설명을 표시합니다
				var infowindow = new kakao.maps.InfoWindow({
					content: '<div style="width:150px;text-align:center;padding:6px 0;">'+title+'</div>'
				});
				infowindow.open(map, marker);

				// 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
				map.setCenter(coords);
			}
		});    
	</script>
						<hr>
					</div>
					<!-- 제목 및 내용 끝-->

					<!-- reply 보여주기-->
					<div th:each="reply: ${replyList}">
						<div class="row" th:if="${reply.isMine == 0}">
							<div class="col-9">
								<span class="me-2">[[${reply.uname}]]</span>
								<span th:text="${#temporals.format(reply.regTime, 'yyyy-MM-dd HH:mm:ss')}"></span><br>
								<span>[(${reply.comment})]</span>
							</div>
							<div class="col-3"></div>
						</div>
						<div class="row" th:if="${reply.isMine == 1}">
							<div class="col-3"></div>
							<div class="col-9 text-end">
								<span class="me-2">[[${reply.uname}]]</span>
								<span th:text="${#temporals.format(reply.regTime, 'yyyy-MM-dd HH:mm:ss')}"></span><br>
								<span>[(${reply.comment})]</span>
							</div>
						</div>
						<hr>
					</div>
						<!-- reply 보여주기 끝-->

						<!-- reply 등록-->
					<form class="form-inline" action="/mid/boardf/reply" method="post">
						<input type="hidden" name="fid" th:value="${boardf.fid}">
						<input type="hidden" name="uid" th:value="${boardf.uid}">
						<div class="row d-flex mt-2" style="align-items: center;">
							<div class="col-1">
								<label class="col-form-label">댓글</label>
							</div>
							<div class="col-9">
								<textarea name="comment" rows="2" class="form-control"></textarea>
							</div>
							<div class="col-2">
								<button type="submit" class="btn btn-primary ms-3">등록</button>
							</div>
						</div>
					</form> 
					<!-- reply 등록 끝-->

					<footer th:replace="~{fragments/base :: bottom}"></footer>


</body>

</html>